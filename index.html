<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hourly Data Entry</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 32px;
        }
        
        .info-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 25px;
        }
        
        .timestamp {
            color: #495057;
            font-weight: 600;
        }
        
        .timer {
            font-size: 20px;
            color: #e74c3c;
            font-weight: bold;
            padding: 10px 20px;
            background: #fff3cd;
            border-radius: 8px;
        }
        
        .form-wrapper {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 600;
            white-space: nowrap;
            font-size: 14px;
        }
        
        td {
            padding: 12px;
            border: 1px solid #dee2e6;
            text-align: center;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #ced4da;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s;
            text-align: center;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }
        
        .submit-btn, .dashboard-btn {
            padding: 15px 40px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        
        .submit-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }
        
        .submit-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        
        .dashboard-btn {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
        }
        
        .dashboard-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 123, 255, 0.3);
        }
        
        .success-message {
            display: none;
            text-align: center;
            padding: 20px;
            background: #d4edda;
            color: #155724;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 18px;
            font-weight: 600;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            background: #cfe2ff;
            color: #084298;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 16px;
        }
        
        .error-message {
            display: none;
            text-align: center;
            padding: 20px;
            background: #f8d7da;
            color: #721c24;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä Hourly Data Collection</h1>
        
        <div class="info-bar">
            <div class="timestamp" id="timestamp"></div>
            <div class="timer" id="timer">‚è∞ Time left: 5:00</div>
        </div>
        
        <form id="dataForm">
            <div class="form-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>User 1</th>
                            <th>User 2</th>
                            <th>User 3</th>
                            <th>User 4</th>
                            <th>User 5</th>
                            <th>User 6</th>
                            <th>User 7</th>
                            <th>User 8</th>
                            <th>User 9</th>
                            <th>User 10</th>
                            <th>User 11</th>
                            <th>User 12</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input type="text" name="user1" placeholder="Enter data"></td>
                            <td><input type="text" name="user2" placeholder="Enter data"></td>
                            <td><input type="text" name="user3" placeholder="Enter data"></td>
                            <td><input type="text" name="user4" placeholder="Enter data"></td>
                            <td><input type="text" name="user5" placeholder="Enter data"></td>
                            <td><input type="text" name="user6" placeholder="Enter data"></td>
                            <td><input type="text" name="user7" placeholder="Enter data"></td>
                            <td><input type="text" name="user8" placeholder="Enter data"></td>
                            <td><input type="text" name="user9" placeholder="Enter data"></td>
                            <td><input type="text" name="user10" placeholder="Enter data"></td>
                            <td><input type="text" name="user11" placeholder="Enter data"></td>
                            <td><input type="text" name="user12" placeholder="Enter data"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="button-group">
                <button type="submit" class="submit-btn" id="submitBtn">‚úÖ Submit Data</button>
                <a href="./dashboard.html" class="dashboard-btn" target="_blank">üìà View Dashboard</a>
            </div>
            
            <div class="loading" id="loadingMsg">‚è≥ Submitting data to server...</div>
            <div class="success-message" id="successMsg">‚úÖ Data submitted successfully! Redirecting to dashboard...</div>
            <div class="error-message" id="errorMsg">‚ùå Error submitting data. Please try again.</div>
        </form>
    </div>

    <script>
        // REPLACE WITH YOUR GOOGLE APPS SCRIPT WEB APP URL
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz5uzhbw23Llg-US6qCo7Lhq-VgvkaW1IXSbZ4Ai3FKLZ8Xn49qmoshgQZLRhD6vca2/exec';
        
        // Display current timestamp
        function updateTimestamp() {
            const now = new Date();
            const timeString = now.toLocaleString('en-IN', { 
                hour12: true,
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('timestamp').textContent = 'üìÖ ' + timeString;
        }
        updateTimestamp();
        
        // Timer countdown (5 minutes = 300 seconds)
        let timeLeft = 300;
        const timerElement = document.getElementById('timer');
        
        function updateTimer() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerElement.textContent = `‚è∞ Time left: ${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            if (timeLeft <= 0) {
                autoSubmitAndClose();
            } else {
                timeLeft--;
            }
        }
        
        const timerInterval = setInterval(updateTimer, 1000);
        
        // Auto-submit and close
        function autoSubmitAndClose() {
            clearInterval(timerInterval);
            submitData();
        }
        
        // Form submission
        document.getElementById('dataForm').addEventListener('submit', function(e) {
            e.preventDefault();
            submitData();
        });
        
        async function submitData() {
            const submitBtn = document.getElementById('submitBtn');
            const loadingMsg = document.getElementById('loadingMsg');
            const successMsg = document.getElementById('successMsg');
            const errorMsg = document.getElementById('errorMsg');
            
            // Hide all messages
            successMsg.style.display = 'none';
            errorMsg.style.display = 'none';
            
            // Show loading
            submitBtn.disabled = true;
            submitBtn.textContent = '‚è≥ Submitting...';
            loadingMsg.style.display = 'block';
            
            const formData = new FormData(document.getElementById('dataForm'));
            const now = new Date();
            
            // Format date as dd-mm-yyyy
            const day = now.getDate().toString().padStart(2, '0');
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const year = now.getFullYear();
            const formattedDate = `${day}-${month}-${year}`;
            
            // Format time as HH:MM (24-hour format)
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const formattedTime = `${hours}:${minutes}`;
            
            // Prepare URL with parameters
            const params = new URLSearchParams({
                action: 'addData',
                timestamp: now.toISOString(),
                date: formattedDate,
                timeSlot: formattedTime,
                user1: formData.get('user1') || 'null',
                user2: formData.get('user2') || 'null',
                user3: formData.get('user3') || 'null',
                user4: formData.get('user4') || 'null',
                user5: formData.get('user5') || 'null',
                user6: formData.get('user6') || 'null',
                user7: formData.get('user7') || 'null',
                user8: formData.get('user8') || 'null',
                user9: formData.get('user9') || 'null',
                user10: formData.get('user10') || 'null',
                user11: formData.get('user11') || 'null',
                user12: formData.get('user12') || 'null'
            });
            
            try {
                const response = await fetch(SCRIPT_URL + '?' + params.toString());
                const result = await response.json();
                
                loadingMsg.style.display = 'none';
                
                if (result.status === 'success') {
                    successMsg.style.display = 'block';
                    submitBtn.textContent = '‚úÖ Submitted!';
                    
                    // Redirect to dashboard after 2 seconds
                    setTimeout(() => {
                        window.location.href = './dashboard.html';
                    }, 1000);
                } else {
                    errorMsg.style.display = 'block';
                    errorMsg.textContent = '‚ùå ' + (result.message || 'Error submitting data. Please try again.');
                    submitBtn.disabled = false;
                    submitBtn.textContent = '‚úÖ Submit Data';
                }
            } catch (error) {
                loadingMsg.style.display = 'none';
                errorMsg.style.display = 'block';
                errorMsg.textContent = '‚ùå Network error. Please check your connection and try again.';
                submitBtn.disabled = false;
                submitBtn.textContent = '‚úÖ Submit Data';
                console.error('Error:', error);
            }
        }
    </script>
</body>
</html>
